---
layout: post
#published : false
title: "선택암호문 공격의 관점으로 바라본 EtM, MtE"
date: 2019-11-09
excerpt: "Encrypt-then-MAC & MAC-then-Encrypt on Chosen CipherText Attack"
tags: [Security]
feature: http://i.imgur.com/Ds6S7lJ.png
comments: true
---

## MtE(MAC-then-Encrypt)  
이 방식은, plaintext data 를 가지고 MAC 값을 계산 후 data 를 암호화 한다(<그림1> 참조).[1] 이 메시지를 받은 수신자는 session key 를 사용하여 data 를 복호화 한 후에 인증을 하게 된다. 따라서 인증되지 않은 공격자가 임의의 메시지를 수신자에게 보내면 수신자는 MAC 값을 검증하기 위해 메시지를 "먼저" 복호화 해야 한다. 여기서 공격자는 트릭을 쓸 수 있는데, 블록암호의 특징 중 평문의 메시지 기링가 암호문 블록 크기의 배수가 되어야 한다는 성질을 이용 할 수 있다. 즉, 메시지에는 이 성질을 만족시키기 위하여 패딩이 들어간다. 패딩은 복호화 단계에 체크가 되며, 유효하지 않은 패딩 값은 에러를 발생시킨다. 공격자는 암호문에서 몇 개의 비트를 반전시켜 패딩 값을 변형할 수 있다.[2] 그리고 이 값을 패딩 오라클에 전송 후 이로부터 받은 타이밍 정보와 에러 정보를 사용하여 평문 값을 알아 낼 수 있게 된다. 이를 패딩 오라클 공격이라고 하며 이는 선택 암호문 공격의 일종이므로[3] MtE가 선택암호문 공격에 취약함을 알 수 있다.
<figure>
    <a href="https://github.com/TimJLee/timjlee.github.io/blob/master/images/Authenticated_Encryption_MtE.png?raw=true"><img src="https://github.com/TimJLee/timjlee.github.io/blob/master/images/Authenticated_Encryption_MtE.png?raw=true"></a>
    <figcaption><그림 1> MtE approach</figcaption>
</figure>  


## EtM(Encrypt-then-MAC)
이 방식은, 데이터를 먼저 암호화 한 후 이 값을 입력으로 하여 MAC값을 계산해낸다. 따라서 수신자는 MAC값을 먼저 확인(체크)하고(인증), MAC 값이 올바르지 않다면 (수신된 MAC 값과 암호문으로부터 얻어진 MAC값이 다르다면) 연결을 끊어버린다.[2] 공격자는 session key 를 알지 못하면 MAC을 위조할 수 없으므로 EtM방식은 패딩 오라클 공격을 포함한 선택암호문 공격에 노출되지 않는다.

<br>
<br>qwertyuiop[]asdfgggghhjjkkkll;;''zzxxcccㅍㅍㅍvvvㅠㅠnnmmm,,.////?|\\~~~~~~!!m,,fgkkdfllefleflefelelefl



### 참조문헌
[1] : wikipedia, "Authenticated encryption"[Online], <https://en.wikipedia.org/wiki/Authenticated_encryption>  
[2] : codeinsecurity, "A quick crypto lesson - why MAC then encrypt is a bad choice"[Online], <https://codeinsecurity.wordpress.com/2013/04/05/quick-crypto-lesson-why-mac-then-encrypt-is-bad>  
[3] : Juliano Rizzo, Thai Duong, "Practical Padding Oracle Attacks", May 25th, 2010
